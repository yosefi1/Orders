# הגדרת Gmail SMTP - מדריך בעברית

## מה צריך לעשות?

להשתמש בחשבון Gmail שלך כדי לשלוח אימיילים מהאתר.
- זה **חינמי לחלוטין**
- עובד מ-Vercel
- לא צריך לפתוח חשבון חדש

---

## שלב 1: יצירת App Password ב-Gmail

### 1.1. פתח את Google Account
1. לך ל: https://myaccount.google.com/
2. התחבר עם חשבון Gmail שלך

### 1.2. הפעל אימות דו-שלבי (אם עדיין לא)
1. לחץ על **"אבטחה"** (Security) בתפריט השמאלי
2. גלול למטה למצא **"אימות דו-שלבי"** (2-Step Verification)
3. לחץ עליו
4. אם זה לא פעיל, הפעל אותו (תצטרך להזין את הסיסמה שלך)

**למה זה חשוב?** Gmail דורש אימות דו-שלבי כדי ליצור App Password.

### 1.3. יצירת App Password
1. אחרי שהפעלת אימות דו-שלבי, חזור ל-**"אבטחה"**
2. גלול למטה למצא **"סיסמאות אפליקציות"** (App passwords)
   - זה נמצא מתחת ל-"אימות דו-שלבי"
3. לחץ על **"סיסמאות אפליקציות"**
4. ייתכן שתתבקש להזין את הסיסמה של Google שוב
5. תראה מסך עם רשימה ריקה (אם זו הפעם הראשונה)
6. לחץ על **"בחר אפליקציה"** → בחר **"דואר"** (Mail)
7. לחץ על **"בחר מכשיר"** → בחר **"אחר (שם מותאם אישית)"** (Other - Custom name)
8. הקלד: `Cafeteria Orders` (או כל שם אחר)
9. לחץ **"צור"** (Generate)
10. **חשוב מאוד!** תראה סיסמה של 16 תווים, למשל: `abcd efgh ijkl mnop`
    - **העתק את הסיסמה הזו עכשיו!** לא תוכל לראות אותה שוב
    - שמור אותה במקום בטוח

---

## שלב 2: הגדרת משתני סביבה ב-Vercel

### 2.1. פתח את Vercel
1. לך ל: https://vercel.com/
2. התחבר לחשבון שלך
3. לחץ על הפרויקט שלך (Orders)

### 2.2. פתח את Environment Variables
1. לחץ על **"Settings"** (הגדרות) בתפריט העליון
2. בתפריט השמאלי, לחץ על **"Environment Variables"**

### 2.3. הוסף/עדכן משתנים

לכל משתנה, לחץ על **"Add New"** או עדכן את הקיים:

#### משתנה 1: SMTP_HOST
- **Key:** `SMTP_HOST`
- **Value:** `smtp.gmail.com`
- **Environments:** בחר **"Production, Preview, Development"** (כל שלושת)

#### משתנה 2: SMTP_PORT
- **Key:** `SMTP_PORT`
- **Value:** `587`
- **Environments:** כל שלושת

#### משתנה 3: SMTP_USER
- **Key:** `SMTP_USER`
- **Value:** כתובת ה-Gmail שלך (למשל: `yourname@gmail.com`)
- **Environments:** כל שלושת

#### משתנה 4: SMTP_PASSWORD
- **Key:** `SMTP_PASSWORD`
- **Value:** ה-App Password שיצרת בשלב 1 (16 תווים, למשל: `abcd efgh ijkl mnop`)
- **Environments:** כל שלושת
- **⚠️ חשוב:** זה הסיסמה המיוחדת שיצרת, לא הסיסמה הרגילה של Gmail!

#### משתנה 5: EMAIL_FROM
- **Key:** `EMAIL_FROM`
- **Value:** אותה כתובת Gmail שלך (למשל: `yourname@gmail.com`)
- **Environments:** כל שלושת

#### משתנה 6: SUPPLIER_EMAIL
- **Key:** `SUPPLIER_EMAIL`
- **Value:** כתובת המייל של הספק (למשל: `supplier@example.com`)
- **Environments:** כל שלושת

#### משתנה 7: CRON_SECRET (אופציונלי - לדוח היומי)
- **Key:** `CRON_SECRET`
- **Value:** סיסמה אקראית (למשל: `my-secret-password-123`)
- **Environments:** כל שלושת

### 2.4. שמור
לאחר שהוספת את כל המשתנים, לחץ **"Save"** (שמור)

---

## שלב 3: Redeploy (פריסה מחדש)

1. ב-Vercel, לחץ על **"Deployments"** בתפריט העליון
2. תראה רשימה של כל הפריסות
3. לחץ על ה-Deployment האחרון (הראשון ברשימה)
4. לחץ על **"⋮"** (שלוש נקודות) בפינה הימנית העליונה
5. לחץ על **"Redeploy"**
6. לחץ **"Redeploy"** שוב לאישור
7. המתן לסיום הפריסה (כמה דקות)

---

## שלב 4: בדיקה

### בדיקת אימייל ללקוח:
1. לך לאתר שלך
2. בצע הזמנה עם כתובת אימייל
3. בדוק אם האימייל הגיע (גם בתיבת Spam)

### בדיקת דוח יומי:
- הדוח נשלח אוטומטית כל יום ב-**10:30 בבוקר** לכתובת הספק
- או תוכל לבדוק ידנית: `https://your-site.vercel.app/api/cron/daily-report`
  - (צריך להוסיף `CRON_SECRET` ב-Environment Variables)

---

## פתרון בעיות

### "Invalid login" או "Authentication failed"
- **סיבה:** לא יצרת App Password או השתמשת בסיסמה הרגילה
- **פתרון:** חזור לשלב 1.3 ויצור App Password חדש

### "Less secure app access"
- **סיבה:** Gmail לא דורש את זה יותר
- **פתרון:** פשוט השתמש ב-App Password (כמו שהסברנו)

### אימיילים לא מגיעים
1. בדוק את תיבת ה-Spam
2. ודא ש-`SUPPLIER_EMAIL` נכון
3. בדוק את ה-Logs ב-Vercel:
   - לך ל-Deployments → לחץ על ה-Deployment → Functions → לחץ על הפונקציה → Logs

### "Cannot connect to SMTP server"
- **סיבה:** בעיית רשת או הגדרות שגויות
- **פתרון:** ודא ש-`SMTP_HOST` = `smtp.gmail.com` ו-`SMTP_PORT` = `587`

---

## סיכום - מה עשינו?

✅ יצרנו App Password ב-Gmail  
✅ הגדרנו משתני סביבה ב-Vercel  
✅ עשינו Redeploy  
✅ האתר יכול לשלוח אימיילים דרך Gmail  

---

## שאלות נפוצות

**Q: האם זה בטוח?**  
A: כן, App Password זה סיסמה מיוחדת רק לאפליקציות, לא הסיסמה הראשית שלך.

**Q: כמה אימיילים אפשר לשלוח?**  
A: עד 500 אימיילים ביום (מספיק למקרה שלך).

**Q: מה אם אשכח את ה-App Password?**  
A: פשוט תצטרך ליצור אחד חדש (ולעדכן ב-Vercel).

**Q: האם זה עובד גם עם Gmail עסקי?**  
A: כן, אותו תהליך בדיוק.

---

**בהצלחה! 🎉**

